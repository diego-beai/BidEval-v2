trigger:
  branches:
    include:
      - main

pool:
  name: Default
  demands:
    - agent.name -equals MacBichos-Mac-Studio

stages:
  - stage: Deploy
    displayName: 'Deploy BidEval v2'
    jobs:
      - job: DeployApp
        displayName: 'Deploy'
        steps:
          - checkout: self
            clean: false

          - script: |
              set -e

              echo "=== Deploying with Docker ==="
              docker stop bideval 2>/dev/null || true
              docker rm -f bideval 2>/dev/null || true

              docker compose build bideval
              docker compose up -d bideval

              echo "Deployment complete!"
            displayName: 'Build & Deploy'
            workingDirectory: $(Build.SourcesDirectory)
            timeoutInMinutes: 10
            env:
              VITE_SUPABASE_URL: $(VITE_SUPABASE_URL)
              VITE_SUPABASE_ANON_KEY: $(VITE_SUPABASE_ANON_KEY)
