{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "scoring-evaluation",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -6224,
        -672
      ],
      "id": "80a48fb8-9ff2-4f04-8046-b866ccb7f5dc",
      "name": "Webhook Scoring",
      "webhookId": "scoring-eval-webhook-001"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "rfq_items_master",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "project_id",
              "condition": "eq",
              "keyValue": "={{ $('Set Input Params1').first().json.project_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -5568,
        -768
      ],
      "id": "8afc345d-aa14-47f2-b6a7-3582bf7c0461",
      "name": "Fetch Requirements",
      "credentials": {
        "supabaseApi": {
          "id": "pI4CpdYLTiEEBmnz",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "provider_responses",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "project_id",
              "condition": "eq",
              "keyValue": "={{ $('Set Input Params1').first().json.project_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -5568,
        -544
      ],
      "id": "ed0c50db-d0c8-4dce-ad3f-7c82e2fe49bd",
      "name": "Fetch Provider Responses",
      "credentials": {
        "supabaseApi": {
          "id": "pI4CpdYLTiEEBmnz",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "scoring_configuration_summary",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "project_id",
              "condition": "eq",
              "keyValue": "={{ $('Set Input Params1').first().json.project_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -5568,
        -320
      ],
      "id": "fetch-scoring-config-001",
      "name": "Fetch Scoring Configuration",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "pI4CpdYLTiEEBmnz",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "append",
        "numberInputs": 3,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -5344,
        -672
      ],
      "id": "2d315f51-9d8b-4969-b833-7e97b058d2f8",
      "name": "Merge Requirements & Responses"
    },
    {
      "parameters": {
        "jsCode": "// =============================================\n// NODO: Prepare Scoring Data (v5 - Dynamic Criteria Support)\n// Supports both hardcoded defaults and dynamic criteria from database\n// =============================================\n\nconst items = $input.all();\n\nconsole.log('ðŸ“Š Prepare Scoring Data - Starting...');\nconsole.log('   Items received:', items.length);\n\n/* =========================\nGet project_id from webhook\n========================= */\nlet projectId = null;\ntry {\n    projectId = $('Set Input Params1').first().json.project_id;\n    console.log('   ðŸ“‹ Project ID:', projectId);\n} catch (e) {\n    console.log('   âš ï¸ Could not get project_id:', e.message);\n}\n\n/* =========================\nGet Dynamic Scoring Configuration (if exists)\n========================= */\nlet dynamicConfig = null;\nlet useDynamicConfig = false;\ntry {\n    const configItems = $('Fetch Scoring Configuration').all();\n    if (configItems && configItems.length > 0 && configItems[0].json.category_name) {\n        // Parse configuration into structured format\n        const configData = configItems.map(item => item.json);\n        dynamicConfig = {\n            categories: {},\n            criteria: {},\n            criteriaWeights: {},\n            categoryWeights: {}\n        };\n        \n        configData.forEach(row => {\n            const catName = row.category_name;\n            const catWeight = parseFloat(row.category_weight) || 0;\n            \n            if (!dynamicConfig.categories[catName]) {\n                dynamicConfig.categories[catName] = {\n                    name: catName,\n                    display_name: row.category_display_name,\n                    weight: catWeight,\n                    color: row.category_color,\n                    criteria: []\n                };\n                dynamicConfig.categoryWeights[catName.toUpperCase()] = catWeight / 100;\n            }\n            \n            if (row.criterion_name) {\n                const critName = row.criterion_name;\n                const critWeight = parseFloat(row.criterion_weight) || 0;\n                const actualWeight = (critWeight * catWeight) / 10000; // criterion_weight% of category_weight%\n                \n                dynamicConfig.criteria[critName] = {\n                    name: critName,\n                    display_name: row.criterion_display_name,\n                    description: row.criterion_description,\n                    category: catName,\n                    weight: critWeight,\n                    keywords: row.criterion_keywords || []\n                };\n                dynamicConfig.criteriaWeights[critName] = actualWeight;\n                dynamicConfig.categories[catName].criteria.push(critName);\n            }\n        });\n        \n        useDynamicConfig = Object.keys(dynamicConfig.criteria).length > 0;\n        console.log('   âœ… Dynamic configuration loaded:', Object.keys(dynamicConfig.criteria).length, 'criteria');\n    }\n} catch (e) {\n    console.log('   âš ï¸ Could not load dynamic config:', e.message);\n}\n\n/* =========================\nDefault Criteria (fallback)\n========================= */\nconst DEFAULT_CRITERIA_WEIGHTS = {\n    scope_facilities: 0.10,\n    scope_work: 0.10,\n    deliverables_quality: 0.10,\n    total_price: 0.15,\n    price_breakdown: 0.08,\n    optionals_included: 0.07,\n    capex_opex_methodology: 0.05,\n    schedule: 0.08,\n    resources_allocation: 0.06,\n    exceptions: 0.06,\n    safety_studies: 0.08,\n    regulatory_compliance: 0.07\n};\n\nconst DEFAULT_CATEGORY_WEIGHTS = {\n    TECHNICAL: 0.30,\n    ECONOMIC: 0.35,\n    EXECUTION: 0.20,\n    HSE_COMPLIANCE: 0.15\n};\n\n// Use dynamic or default\nconst CRITERIA_WEIGHTS = useDynamicConfig ? dynamicConfig.criteriaWeights : DEFAULT_CRITERIA_WEIGHTS;\nconst CATEGORY_WEIGHTS = useDynamicConfig ? dynamicConfig.categoryWeights : DEFAULT_CATEGORY_WEIGHTS;\n\nconsole.log('   ðŸ“Š Using', useDynamicConfig ? 'DYNAMIC' : 'DEFAULT', 'configuration');\nconsole.log('   ðŸ“Š Criteria:', Object.keys(CRITERIA_WEIGHTS).join(', '));\n\n/* =========================\nHelpers - Map requirements to criteria\n========================= */\nfunction getCriterionFromRequirement(evalType, phase, reqText, keywords) {\n    const type = (evalType || '').toLowerCase();\n    const phaseL = (phase || '').toLowerCase();\n    const text = (reqText || '').toLowerCase();\n    \n    // If using dynamic config, try to match by keywords first\n    if (useDynamicConfig && dynamicConfig.criteria) {\n        for (const [critName, critInfo] of Object.entries(dynamicConfig.criteria)) {\n            const kws = critInfo.keywords || [];\n            for (const kw of kws) {\n                if (text.includes(kw.toLowerCase())) {\n                    return critName;\n                }\n            }\n        }\n    }\n    \n    // Fallback to default mapping logic\n    if (type.includes('technical')) {\n        if (text.includes('scope of facilities') || text.includes('hydrogen plant') || text.includes('utilities')) {\n            return 'scope_facilities';\n        }\n        if (text.includes('scope of work') || text.includes('project management') || text.includes('deliverables')) {\n            return 'scope_work';\n        }\n        if (text.includes('p&id') || text.includes('3d model') || text.includes('specification') || text.includes('datasheet')) {\n            return 'deliverables_quality';\n        }\n        return 'scope_work';\n    }\n    \n    if (type.includes('econom')) {\n        if (text.includes('price') || text.includes('â‚¬') || text.includes('fee') || text.includes('cost')) {\n            return 'total_price';\n        }\n        if (text.includes('hour') || text.includes('discipline') || text.includes('breakdown')) {\n            return 'price_breakdown';\n        }\n        if (text.includes('optional') || text.includes('geotechnical') || text.includes('topograph') || text.includes('hazid')) {\n            return 'optionals_included';\n        }\n        if (text.includes('capex') || text.includes('opex') || text.includes('aacei') || text.includes('estimate')) {\n            return 'capex_opex_methodology';\n        }\n        return 'total_price';\n    }\n    \n    if (text.includes('hse') || text.includes('safety') || text.includes('hazop') || text.includes('hazid') || text.includes('atex') || text.includes('qra')) {\n        return 'safety_studies';\n    }\n    if (text.includes('code') || text.includes('standard') || text.includes('compliance') || text.includes('regulation')) {\n        return 'regulatory_compliance';\n    }\n    \n    if (phaseL.includes('pre-feed') || phaseL.includes('feed') || type.includes('deliverable')) {\n        if (text.includes('schedule') || text.includes('planning') || text.includes('timeline')) {\n            return 'schedule';\n        }\n        if (text.includes('exception') || text.includes('deviation') || text.includes('exclusion')) {\n            return 'exceptions';\n        }\n        return 'resources_allocation';\n    }\n    \n    return 'scope_work';\n}\n\nfunction classifyEval(val) {\n    const v = (val || '').toUpperCase();\n    if (v.includes('INCLUD') || v.includes('INCLUIDO') || v === 'SI' || v === 'YES') return 'INCLUDED';\n    if (v.includes('PARCIAL') || v.includes('PARTIAL')) return 'PARTIAL';\n    if (v.includes('NO INCLUD') || v.includes('NOT INCLUD') || v === 'NO') return 'NOT_INCLUDED';\n    return 'NO_INFO';\n}\n\n/* =========================\nGet data from previous nodes\n========================= */\nlet requirements = [];\nlet responses = [];\n\ntry {\n    const reqItems = $('Fetch Requirements').all();\n    requirements = reqItems.map(item => item.json);\n    console.log('   âœ… Requirements from Fetch Requirements:', requirements.length);\n} catch (e) {\n    console.log('   âš ï¸ Could not access Fetch Requirements:', e.message);\n}\n\ntry {\n    const respItems = $('Fetch Provider Responses').all();\n    responses = respItems.map(item => item.json);\n    console.log('   âœ… Responses from Fetch Provider Responses:', responses.length);\n} catch (e) {\n    console.log('   âš ï¸ Could not access Fetch Provider Responses:', e.message);\n}\n\nif (requirements.length === 0 || responses.length === 0) {\n    console.log('   ðŸ”„ Using fallback: separating from input...');\n    items.forEach(item => {\n        const data = item.json;\n        if (data.requirement_text && !data.provider_name) {\n            requirements.push(data);\n        } else if (data.provider_name && data.requirement_id) {\n            responses.push(data);\n        }\n    });\n}\n\nif (requirements.length === 0) {\n    return [{ json: { error: 'No requirements found', items_received: items.length } }];\n}\nif (responses.length === 0) {\n    return [{ json: { error: 'No responses found', items_received: items.length } }];\n}\n\n/* =========================\nOptimization with MAPS\n========================= */\nconst requirementMap = {};\nrequirements.forEach(r => {\n    if (r.id) requirementMap[r.id] = r;\n});\n\nconst responsesByProvider = {};\nresponses.forEach(r => {\n    if (r.provider_name) {\n        if (!responsesByProvider[r.provider_name]) {\n            responsesByProvider[r.provider_name] = [];\n        }\n        responsesByProvider[r.provider_name].push(r);\n    }\n});\n\nconsole.log('   ðŸ“Š Providers found:', Object.keys(responsesByProvider).join(', '));\n\n/* =========================\nProvider filter (optional)\n========================= */\nlet providerFilter = '';\ntry {\n    providerFilter = $('Set Input Params1').first().json.provider_filter || '';\n} catch (e) {}\n\nlet providers = Object.keys(responsesByProvider);\nif (providerFilter) {\n    providers = providers.filter(p => p.toLowerCase().includes(providerFilter.toLowerCase()));\n}\n\nif (providers.length === 0) {\n    return [{ json: { error: 'No providers found', filter: providerFilter } }];\n}\n\n/* =========================\nEvaluation by Criteria\n========================= */\nconst evaluationData = providers.map(providerName => {\n    const providerResponses = responsesByProvider[providerName] || [];\n    \n    // Initialize criteria summary\n    const criteriaScores = {};\n    Object.keys(CRITERIA_WEIGHTS).forEach(criterion => {\n        criteriaScores[criterion] = { total: 0, included: 0, partial: 0, not_included: 0, no_info: 0, scores: [] };\n    });\n    \n    providerResponses.forEach(resp => {\n        const req = requirementMap[resp.requirement_id];\n        if (!req) return;\n        \n        const criterion = getCriterionFromRequirement(req.evaluation_type, req.phase, req.requirement_text);\n        const evalClass = classifyEval(resp.evaluation_value);\n        \n        const cs = criteriaScores[criterion];\n        if (!cs) return;\n        \n        cs.total++;\n        if (evalClass === 'INCLUDED') cs.included++;\n        else if (evalClass === 'PARTIAL') cs.partial++;\n        else if (evalClass === 'NOT_INCLUDED') cs.not_included++;\n        else cs.no_info++;\n        \n        if (typeof resp.score === 'number') {\n            cs.scores.push(resp.score);\n        }\n    });\n    \n    // Calculate average scores per criterion\n    let globalScore = 0;\n    const criteriaAvgScores = {};\n    \n    Object.keys(criteriaScores).forEach(criterion => {\n        const cs = criteriaScores[criterion];\n        if (cs.scores.length > 0) {\n            cs.avg_score = Math.round((cs.scores.reduce((a, b) => a + b, 0) / cs.scores.length) * 100) / 100;\n        } else if (cs.total > 0) {\n            cs.avg_score = Math.round(((cs.included * 10 + cs.partial * 5) / cs.total) * 100) / 100;\n        } else {\n            cs.avg_score = 0;\n        }\n        criteriaAvgScores[criterion] = cs.avg_score;\n        globalScore += cs.avg_score * (CRITERIA_WEIGHTS[criterion] || 0);\n        delete cs.scores;\n    });\n    \n    globalScore = Math.round(globalScore * 100) / 100;\n    \n    // Calculate category scores dynamically\n    let categoryScores = {};\n    if (useDynamicConfig) {\n        for (const [catName, catInfo] of Object.entries(dynamicConfig.categories)) {\n            const catCriteria = catInfo.criteria || [];\n            const scores = catCriteria.map(c => criteriaAvgScores[c] || 0);\n            const avg = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n            categoryScores[catName.toUpperCase()] = Math.round(avg * 100) / 100;\n        }\n    } else {\n        categoryScores = {\n            TECHNICAL: Math.round(((criteriaAvgScores.scope_facilities || 0) + (criteriaAvgScores.scope_work || 0) + (criteriaAvgScores.deliverables_quality || 0)) / 3 * 100) / 100,\n            ECONOMIC: Math.round(((criteriaAvgScores.total_price || 0) + (criteriaAvgScores.price_breakdown || 0) + (criteriaAvgScores.optionals_included || 0) + (criteriaAvgScores.capex_opex_methodology || 0)) / 4 * 100) / 100,\n            EXECUTION: Math.round(((criteriaAvgScores.schedule || 0) + (criteriaAvgScores.resources_allocation || 0) + (criteriaAvgScores.exceptions || 0)) / 3 * 100) / 100,\n            HSE_COMPLIANCE: Math.round(((criteriaAvgScores.safety_studies || 0) + (criteriaAvgScores.regulatory_compliance || 0)) / 2 * 100) / 100\n        };\n    }\n    \n    return {\n        provider_name: providerName,\n        project_id: projectId,\n        total_responses: providerResponses.length,\n        global_score: globalScore,\n        category_scores: categoryScores,\n        criteria_scores: criteriaAvgScores,\n        criteria_summary: criteriaScores,\n        config_type: useDynamicConfig ? 'dynamic' : 'default',\n        scoring_config: useDynamicConfig ? dynamicConfig : null\n    };\n});\n\n/* =========================\nExecutive Ranking\n========================= */\nevaluationData\n    .sort((a, b) => b.global_score - a.global_score)\n    .forEach((item, index) => {\n        item.rank = index + 1;\n    });\n\nconsole.log('âœ… Scoring Data prepared for', evaluationData.length, 'providers');\nconsole.log('   Project ID included:', projectId);\nconsole.log('   Config type:', useDynamicConfig ? 'DYNAMIC' : 'DEFAULT');\n\nreturn evaluationData.map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5120,
        -672
      ],
      "id": "7dac02ec-b781-4246-ae88-30e1f446d614",
      "name": "Prepare Scoring Data"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -4896,
        -720
      ],
      "id": "40bc72b8-62b5-417a-b7c1-5a416bf89106",
      "name": "Loop Over Providers"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Score this engineering proposal provider based on RFQ compliance.\n\n## PROVIDER: {{ $json.provider_name }}\n## TOTAL RESPONSES: {{ $json.total_responses }}\n## CONFIG TYPE: {{ $json.config_type || 'default' }}\n\n## CATEGORY SCORES (pre-calculated):\n{{ JSON.stringify($json.category_scores, null, 2) }}\n\n## INDIVIDUAL CRITERIA SCORES:\n{{ JSON.stringify($json.criteria_scores, null, 2) }}\n\n## CRITERIA DETAILS:\n{{ JSON.stringify($json.criteria_summary, null, 2) }}\n\n{{ $json.scoring_config ? '## DYNAMIC SCORING CONFIGURATION:\\n' + JSON.stringify($json.scoring_config.categories, null, 2) : '' }}\n\n## EVALUATION CRITERIA (weights):\n{{ $json.scoring_config ? Object.entries($json.scoring_config.categories).map(([name, cat]) => `### ${cat.display_name} (${cat.weight}%)\\n${cat.criteria.map(c => `- ${c}: ${$json.scoring_config.criteria[c]?.description || ''}`).join('\\n')}`).join('\\n\\n') : `### TECHNICAL COMPLETENESS (30%)\n- scope_facilities: 10% - H2 plant, BOP, utilities included\n- scope_work: 10% - PM, studies, deliverables covered\n- deliverables_quality: 10% - P&IDs, specs, 3D model quality\n\n### ECONOMIC COMPETITIVENESS (35%)\n- total_price: 15% - PRE-FEED + FEED + EPC price competitiveness\n- price_breakdown: 8% - Transparent hours/discipline, â‚¬/hour\n- optionals_included: 7% - Geotechnical, topographic, 3D, HAZID in base\n- capex_opex_methodology: 5% - AACEI class, estimate robustness\n\n### EXECUTION CAPABILITY (20%)\n- schedule: 8% - Realistic timeline vs requirements\n- resources_allocation: 6% - Coherent hours per discipline\n- exceptions: 6% - Fewer exceptions = better (invert score)\n\n### HSE & COMPLIANCE (15%)\n- safety_studies: 8% - HAZID, HAZOP, QRA, ATEX included\n- regulatory_compliance: 7% - Codes, standards, safety distances` }}\n\n## SCORING RULES:\n- included items = 10 points\n- partial items = 6 points\n- not_included items = 2 points\n- no_info items = 0 points\n- For 'exceptions': FEWER is BETTER (invert: more exceptions = lower score)\n\n## OUTPUT (JSON only):\n{\n  \"provider_name\": \"string\",\n  \"category_scores\": {\n    {{ $json.scoring_config ? Object.keys($json.scoring_config.categories).map(name => `\"${name.toUpperCase()}\": { \"score\": number, \"weight\": ${$json.scoring_config.categories[name].weight / 100} }`).join(',\\n    ') : `\"TECHNICAL\": { \"score\": number, \"weight\": 0.30 },\n    \"ECONOMIC\": { \"score\": number, \"weight\": 0.35 },\n    \"EXECUTION\": { \"score\": number, \"weight\": 0.20 },\n    \"HSE_COMPLIANCE\": { \"score\": number, \"weight\": 0.15 }` }}\n  },\n  \"individual_scores\": {\n    {{ Object.keys($json.criteria_scores).map(k => `\"${k}\": number`).join(',\\n    ') }}\n  },\n  \"overall_score\": number,\n  \"compliance_percentage\": number,\n  \"evaluation_summary\": \"1-2 sentences comparing to ideal proposal\",\n  \"strengths\": [\"max 3 specific strengths\"],\n  \"weaknesses\": [\"max 3 specific areas for improvement\"]\n}",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.8,
      "position": [
        -4624,
        -704
      ],
      "id": "8e3da58b-a279-4c03-ac07-e0e73345ff00",
      "name": "Scoring LLM Chain"
    },
    {
      "parameters": {
        "jsCode": "// =============================================\n// NODE: Calculate Weighted Scores (v5 - Dynamic Criteria Support)\n// Extract and structure scores for database storage\n// =============================================\n\nconst input = $input.first().json;\nconst llmOutput = input.output || input;\n\n// Get project_id and config\nlet projectId = null;\nlet configType = 'default';\ntry { \n    projectId = $('Set Input Params1').first().json.project_id;\n    configType = $('Loop Over Providers').item.json.config_type || 'default';\n} catch(e) {}\n\n// Extract category scores\nconst cs = llmOutput.category_scores || {};\nconst tech = (cs.TECHNICAL && cs.TECHNICAL.score) || cs.TECHNICAL || 0;\nconst econ = (cs.ECONOMIC && cs.ECONOMIC.score) || cs.ECONOMIC || 0;\nconst exec = (cs.EXECUTION && cs.EXECUTION.score) || cs.EXECUTION || 0;\nconst hse = (cs.HSE_COMPLIANCE && cs.HSE_COMPLIANCE.score) || cs.HSE_COMPLIANCE || 0;\n\n// Extract individual criterion scores\nconst is = llmOutput.individual_scores || {};\n\nreturn [{\n    json: {\n        ranking: {\n            provider_name: llmOutput.provider_name,\n            project_id: projectId,\n            // Category scores\n            technical_score: tech,\n            economic_score: econ,\n            execution_score: exec,\n            hse_compliance_score: hse,\n            // TECHNICAL COMPLETENESS individual scores (30%)\n            scope_facilities_score: is.scope_facilities || 0,\n            scope_work_score: is.scope_work || 0,\n            deliverables_quality_score: is.deliverables_quality || 0,\n            // ECONOMIC COMPETITIVENESS individual scores (35%)\n            total_price_score: is.total_price || 0,\n            price_breakdown_score: is.price_breakdown || 0,\n            optionals_included_score: is.optionals_included || 0,\n            capex_opex_methodology_score: is.capex_opex_methodology || 0,\n            // EXECUTION CAPABILITY individual scores (20%)\n            schedule_score: is.schedule || 0,\n            resources_allocation_score: is.resources_allocation || 0,\n            exceptions_score: is.exceptions || 0,\n            // HSE & COMPLIANCE individual scores (15%)\n            safety_studies_score: is.safety_studies || 0,\n            regulatory_compliance_score: is.regulatory_compliance || 0,\n            // Overall metrics\n            overall_score: llmOutput.overall_score || 0,\n            compliance_percentage: llmOutput.compliance_percentage || 0,\n            evaluation_count: 1,\n            last_updated: new Date().toISOString()\n        },\n        details: {\n            strengths: llmOutput.strengths || [],\n            weaknesses: llmOutput.weaknesses || [],\n            recommendations: llmOutput.recommendations || [],\n            summary: llmOutput.evaluation_summary || ''\n        },\n        category_scores: cs,\n        individual_scores: is,\n        config_type: configType\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4240,
        -704
      ],
      "id": "66c4607f-937d-47b6-9cfc-f91066a1d51f",
      "name": "Calculate Weighted Scores"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "ranking_proveedores",
        "limit": 1
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -4000,
        -704
      ],
      "id": "17d55b31-65f0-4fab-90eb-c53128da355e",
      "name": "Check Provider Exists",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "pI4CpdYLTiEEBmnz",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "provider-exists-condition",
              "leftValue": "={{ $json.provider_name }}",
              "rightValue": "={{ $('Loop Over Providers').item.json.provider_name }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3760,
        -704
      ],
      "id": "4aa6d9cd-4e3a-4508-ba55-df9c637dcb3d",
      "name": "Provider Exists?"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "ranking_proveedores",
        "filters": {
          "conditions": [
            {
              "keyName": "provider_name",
              "condition": "eq",
              "keyValue": "={{ $('Calculate Weighted Scores').item.json.ranking.provider_name }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "project_id",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.project_id || null }}"
            },
            {
              "fieldId": "technical_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.technical_score || 0 }}"
            },
            {
              "fieldId": "economic_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.economic_score || 0 }}"
            },
            {
              "fieldId": "execution_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.execution_score || 0 }}"
            },
            {
              "fieldId": "hse_compliance_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.hse_compliance_score || 0 }}"
            },
            {
              "fieldId": "scope_facilities_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.scope_facilities_score || 0 }}"
            },
            {
              "fieldId": "scope_work_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.scope_work_score || 0 }}"
            },
            {
              "fieldId": "deliverables_quality_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.deliverables_quality_score || 0 }}"
            },
            {
              "fieldId": "total_price_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.total_price_score || 0 }}"
            },
            {
              "fieldId": "price_breakdown_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.price_breakdown_score || 0 }}"
            },
            {
              "fieldId": "optionals_included_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.optionals_included_score || 0 }}"
            },
            {
              "fieldId": "capex_opex_methodology_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.capex_opex_methodology_score || 0 }}"
            },
            {
              "fieldId": "schedule_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.schedule_score || 0 }}"
            },
            {
              "fieldId": "resources_allocation_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.resources_allocation_score || 0 }}"
            },
            {
              "fieldId": "exceptions_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.exceptions_score || 0 }}"
            },
            {
              "fieldId": "safety_studies_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.safety_studies_score || 0 }}"
            },
            {
              "fieldId": "regulatory_compliance_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.regulatory_compliance_score || 0 }}"
            },
            {
              "fieldId": "overall_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.overall_score || 0 }}"
            },
            {
              "fieldId": "compliance_percentage",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.compliance_percentage || 0 }}"
            },
            {
              "fieldId": "evaluation_count",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.evaluation_count || 0 }}"
            },
            {
              "fieldId": "last_updated",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.last_updated }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3520,
        -800
      ],
      "id": "a9ab4e42-1d98-4597-ac38-03c8d7d0d66d",
      "name": "Update Ranking",
      "credentials": {
        "supabaseApi": {
          "id": "pI4CpdYLTiEEBmnz",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "ranking_proveedores",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "provider_name",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.provider_name }}"
            },
            {
              "fieldId": "project_id",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.project_id || null }}"
            },
            {
              "fieldId": "technical_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.technical_score || 0 }}"
            },
            {
              "fieldId": "economic_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.economic_score || 0 }}"
            },
            {
              "fieldId": "execution_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.execution_score || 0 }}"
            },
            {
              "fieldId": "hse_compliance_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.hse_compliance_score || 0 }}"
            },
            {
              "fieldId": "scope_facilities_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.scope_facilities_score || 0 }}"
            },
            {
              "fieldId": "scope_work_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.scope_work_score || 0 }}"
            },
            {
              "fieldId": "deliverables_quality_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.deliverables_quality_score || 0 }}"
            },
            {
              "fieldId": "total_price_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.total_price_score || 0 }}"
            },
            {
              "fieldId": "price_breakdown_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.price_breakdown_score || 0 }}"
            },
            {
              "fieldId": "optionals_included_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.optionals_included_score || 0 }}"
            },
            {
              "fieldId": "capex_opex_methodology_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.capex_opex_methodology_score || 0 }}"
            },
            {
              "fieldId": "schedule_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.schedule_score || 0 }}"
            },
            {
              "fieldId": "resources_allocation_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.resources_allocation_score || 0 }}"
            },
            {
              "fieldId": "exceptions_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.exceptions_score || 0 }}"
            },
            {
              "fieldId": "safety_studies_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.safety_studies_score || 0 }}"
            },
            {
              "fieldId": "regulatory_compliance_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.regulatory_compliance_score || 0 }}"
            },
            {
              "fieldId": "overall_score",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.overall_score || 0 }}"
            },
            {
              "fieldId": "compliance_percentage",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.compliance_percentage || 0 }}"
            },
            {
              "fieldId": "evaluation_count",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.evaluation_count || 0 }}"
            },
            {
              "fieldId": "last_updated",
              "fieldValue": "={{ $('Calculate Weighted Scores').item.json.ranking.last_updated }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3520,
        -592
      ],
      "id": "2019fe61-51b0-4ab5-ae68-ba7c8df721f9",
      "name": "Insert Ranking",
      "credentials": {
        "supabaseApi": {
          "id": "pI4CpdYLTiEEBmnz",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "all_rankings",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -4624,
        -880
      ],
      "id": "80236db6-6edd-4ec2-8164-9f7c27777c36",
      "name": "Aggregate All Rankings"
    },
    {
      "parameters": {
        "jsCode": "// =============================================\n// NODE: Generate Final Ranking with Details (v5 - Dynamic Criteria)\n// Supports both default and dynamic criteria configurations\n// =============================================\n\nconst items = $input.all();\nlet allRankings = [];\n\nitems.forEach(item => {\n    if (item.json.all_rankings) {\n        allRankings = allRankings.concat(item.json.all_rankings);\n    } else if (item.json.ranking) {\n        allRankings.push(item.json);\n    }\n});\n\nconst sortedRankings = allRankings\n    .map(r => ({\n        ranking: r.ranking || r,\n        details: r.details || {},\n        category_scores: r.category_scores || {},\n        individual_scores: r.individual_scores || {},\n        config_type: r.config_type || 'default'\n    }))\n    .sort((a, b) => (b.ranking.overall_score || 0) - (a.ranking.overall_score || 0));\n\nconst finalRanking = sortedRankings.map((r, idx) => ({\n    position: idx + 1,\n    provider_name: r.ranking.provider_name,\n    overall_score: r.ranking.overall_score,\n    compliance_percentage: r.ranking.compliance_percentage,\n    scores: {\n        technical: r.ranking.technical_score,\n        economic: r.ranking.economic_score,\n        execution: r.ranking.execution_score,\n        hse_compliance: r.ranking.hse_compliance_score\n    },\n    individual_scores: {\n        scope_facilities: r.ranking.scope_facilities_score || r.individual_scores?.scope_facilities || 0,\n        scope_work: r.ranking.scope_work_score || r.individual_scores?.scope_work || 0,\n        deliverables_quality: r.ranking.deliverables_quality_score || r.individual_scores?.deliverables_quality || 0,\n        total_price: r.ranking.total_price_score || r.individual_scores?.total_price || 0,\n        price_breakdown: r.ranking.price_breakdown_score || r.individual_scores?.price_breakdown || 0,\n        optionals_included: r.ranking.optionals_included_score || r.individual_scores?.optionals_included || 0,\n        capex_opex_methodology: r.ranking.capex_opex_methodology_score || r.individual_scores?.capex_opex_methodology || 0,\n        schedule: r.ranking.schedule_score || r.individual_scores?.schedule || 0,\n        resources_allocation: r.ranking.resources_allocation_score || r.individual_scores?.resources_allocation || 0,\n        exceptions: r.ranking.exceptions_score || r.individual_scores?.exceptions || 0,\n        safety_studies: r.ranking.safety_studies_score || r.individual_scores?.safety_studies || 0,\n        regulatory_compliance: r.ranking.regulatory_compliance_score || r.individual_scores?.regulatory_compliance || 0\n    },\n    evaluation: {\n        strengths: r.details.strengths || [],\n        weaknesses: r.details.weaknesses || [],\n        recommendations: r.details.recommendations || [],\n        summary: r.details.summary || ''\n    }\n}));\n\nconst configType = sortedRankings[0]?.config_type || 'default';\n\nconst stats = {\n    total_providers: finalRanking.length,\n    average_score: finalRanking.reduce((sum, r) => sum + (r.overall_score || 0), 0) / (finalRanking.length || 1),\n    top_performer: finalRanking[0]?.provider_name || 'N/A',\n    score_range: {\n        min: Math.min(...finalRanking.map(r => r.overall_score || 0)),\n        max: Math.max(...finalRanking.map(r => r.overall_score || 0))\n    },\n    evaluation_date: new Date().toISOString(),\n    config_type: configType\n};\n\nconsole.log(`ðŸ† Final Ranking Generated (${configType} config):`);\nfinalRanking.forEach(r => {\n    console.log(`   ${r.position}. ${r.provider_name}: ${r.overall_score} (${r.compliance_percentage}%)`);\n});\n\nreturn {\n    json: {\n        success: true,\n        ranking: finalRanking,\n        statistics: stats,\n        message: `Scoring completed for ${finalRanking.length} providers using ${configType} criteria configuration`\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4336,
        -880
      ],
      "id": "9911d780-d334-4252-b664-5d1f630357a3",
      "name": "Generate Final Ranking"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -4112,
        -880
      ],
      "id": "52ae6dae-9765-4600-b147-5d93205e9fa1",
      "name": "Respond with Ranking"
    },
    {
      "parameters": {
        "content": "## Scoring Workflow - Provider Evaluation (v5)\n## Dynamic Criteria Support\n\nThis workflow now supports:\n1. **Default criteria** - 11 hardcoded criteria for engineering proposals\n2. **Dynamic criteria** - Custom criteria loaded from `scoring_configuration_summary` view\n\n### How it works:\n1. Fetches scoring configuration for the project\n2. If configuration exists, uses dynamic criteria and weights\n3. If no configuration, falls back to default criteria\n\n### Default Category Weights:\n- **TECHNICAL COMPLETENESS (30%)**\n- **ECONOMIC COMPETITIVENESS (35%)**\n- **EXECUTION CAPABILITY (20%)**\n- **HSE & COMPLIANCE (15%)**\n\n### Endpoint:\nPOST /webhook/scoring-evaluation\n```json\n{\n  \"project_id\": \"uuid\",\n  \"provider_name\": \"filter\",\n  \"recalculate_all\": false\n}\n```\n\n### Response includes:\n- `config_type`: 'dynamic' or 'default'\n- `ranking`: Sorted provider scores\n- `statistics`: Summary stats",
        "height": 1264,
        "width": 3280
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6576,
        -1264
      ],
      "id": "e6f8e8e4-c5f3-4a82-b504-65e2265279d2",
      "name": "Workflow Info"
    },
    {
      "parameters": {
        "content": "## AI Scoring (v5)\n\nEvaluates engineering proposals using:\n- Dynamic OR default criteria\n- Custom weights from database\n- Value-for-money comparison\n- Strengths and weaknesses\n\nStructured JSON output",
        "height": 220,
        "width": 320,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4720,
        -1120
      ],
      "id": "30a37d95-a4d0-483e-9253-8b70d00dcee9",
      "name": "LLM Scoring Info"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "project_id",
              "name": "project_id",
              "value": "={{ $('Webhook Scoring').first().json.body.project_id }}",
              "type": "string"
            },
            {
              "id": "provider_filter",
              "name": "provider_filter",
              "value": "={{ $('Webhook Scoring').first().json.body.provider_name || '' }}",
              "type": "string"
            },
            {
              "id": "recalculate_all",
              "name": "recalculate_all",
              "value": "={{ $('Webhook Scoring').first().json.body.recalculate_all || false }}",
              "type": "boolean"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -5792,
        -672
      ],
      "id": "ee4d76e5-9c5a-492f-b2ba-c6eea95b382d",
      "name": "Set Input Params1"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"provider_name\": { \"type\": \"string\" },\n    \"category_scores\": {\n      \"type\": \"object\",\n      \"additionalProperties\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"score\": { \"type\": \"number\" },\n          \"weight\": { \"type\": \"number\" }\n        }\n      }\n    },\n    \"individual_scores\": {\n      \"type\": \"object\",\n      \"additionalProperties\": { \"type\": \"number\" }\n    },\n    \"overall_score\": { \"type\": \"number\" },\n    \"compliance_percentage\": { \"type\": \"number\" },\n    \"evaluation_summary\": { \"type\": \"string\" },\n    \"strengths\": { \"type\": \"array\", \"items\": { \"type\": \"string\" } },\n    \"weaknesses\": { \"type\": \"array\", \"items\": { \"type\": \"string\" } },\n    \"recommendations\": { \"type\": \"array\", \"items\": { \"type\": \"string\" } }\n  },\n  \"required\": [\"provider_name\", \"category_scores\", \"individual_scores\", \"overall_score\", \"compliance_percentage\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4480,
        -480
      ],
      "id": "789ba059-97e7-4c18-8f00-2d18157d131e",
      "name": "JSON Output Parser1"
    },
    {
      "parameters": {
        "model": "qwen3:8b",
        "options": {
          "temperature": 0.1,
          "numCtx": 8192,
          "numPredict": 2048
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -4736,
        -496
      ],
      "id": "7e150cde-5bb2-4fa0-a4c9-5a33e3178c7c",
      "name": "Ollama Scoring Model",
      "credentials": {
        "ollamaApi": {
          "id": "oS2Qqti9oVfsm8XZ",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "ranking_proveedores",
        "filters": {
          "conditions": [
            {
              "keyName": "provider_name",
              "condition": "neq",
              "keyValue": "R"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -6016,
        -672
      ],
      "id": "c8d0c805-27d9-4c28-9df5-f077ab16fdcc",
      "name": "Delete a row",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "pI4CpdYLTiEEBmnz",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -4640,
        -400
      ],
      "id": "6b3904f3-189b-4d03-902a-6a2dc4536c75",
      "name": "OpenRouter Chat Model1",
      "credentials": {
        "openRouterApi": {
          "id": "4AyUqsh1Z35g6bci",
          "name": "OpenRouter account"
        }
      }
    }
  ],
  "connections": {
    "Webhook Scoring": {
      "main": [
        [
          {
            "node": "Delete a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Requirements": {
      "main": [
        [
          {
            "node": "Merge Requirements & Responses",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Provider Responses": {
      "main": [
        [
          {
            "node": "Merge Requirements & Responses",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Fetch Scoring Configuration": {
      "main": [
        [
          {
            "node": "Merge Requirements & Responses",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Merge Requirements & Responses": {
      "main": [
        [
          {
            "node": "Prepare Scoring Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Scoring Data": {
      "main": [
        [
          {
            "node": "Loop Over Providers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Providers": {
      "main": [
        [
          {
            "node": "Aggregate All Rankings",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Scoring LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scoring LLM Chain": {
      "main": [
        [
          {
            "node": "Calculate Weighted Scores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Weighted Scores": {
      "main": [
        [
          {
            "node": "Check Provider Exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Provider Exists": {
      "main": [
        [
          {
            "node": "Provider Exists?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Provider Exists?": {
      "main": [
        [
          {
            "node": "Update Ranking",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Insert Ranking",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Ranking": {
      "main": [
        [
          {
            "node": "Loop Over Providers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Ranking": {
      "main": [
        [
          {
            "node": "Loop Over Providers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate All Rankings": {
      "main": [
        [
          {
            "node": "Generate Final Ranking",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Final Ranking": {
      "main": [
        [
          {
            "node": "Respond with Ranking",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Input Params1": {
      "main": [
        [
          {
            "node": "Fetch Requirements",
            "type": "main",
            "index": 0
          },
          {
            "node": "Fetch Provider Responses",
            "type": "main",
            "index": 0
          },
          {
            "node": "Fetch Scoring Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JSON Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Scoring LLM Chain",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Scoring Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Delete a row": {
      "main": [
        [
          {
            "node": "Set Input Params1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Scoring LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "53140335eaf11280ef77ef2f5a378f48c2b28e822e3e0d96563cdd92175c0eff"
  }
}
